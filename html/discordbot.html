<!DOCTYPE html>

<html>

<head>
    <title>Discord bot</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="Discord, api">
    <meta name="author" content="Aely">

    <link rel="stylesheet" href="../css/main.css">
</head>

<body>

    <div class="topnav">
        <a href="../index.html"><img src="../img/double_arrow_white.png" width="40px" height="40px"/></a>
        <a href="../index.html">Home</a>
    </div>

    <div id="text_center">
        <h1>Discord bot for my WoW guild</h1>

        <p>
          My World of Warcraft guild decided to switch from a web forum + teamspeack to discord. The person in charge of creating the discord server was able to integrate most of the
          functionalities of the forum but couldn't find a discord bot compatible with our web calendar so she asked me if I could help her.

          As I've never code a discord bot before I first had to check how it work and then find a way to display the information from our web calendar.
        </p>

        <h3>Discord bot</h3>

        <p>
          There is a lot of good <a href="https://discordjs.guide/#/preparations/setting-up-a-bot-application" target="_blank">tutorial</a> online on how to create a simple discord bot.
          This is quite easy, you just need to create a <b>node.js</b> app and a bot on the discord website and linked them together with a token provided on the discord application page.

  <pre><code>
client.on("message", message => {
  if (message.author.bot) return;
  //SPLIT to get command and argument
  if (message.content.indexOf(config.prefix) !== 0) return;

  const args = message.content.slice(config.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();

  if(command === 'ping') {
    message.channel.send('Pong!');
  }
}
</pre></code>

          This function check for each message on the server if this is a command (start with the prefix character defined in a config file, in my case '!'), and send the
          designed response if we defined one. For exemple if a user type "!ping", the bot send to the same channel "Pong!".

          <img src="../img/discord_bot_ping.jpg"/>
        </p>

        <h3>Mushraider API</h3>

        <p>
          The only hard thing in this part is that the mushraid api <a href="http://mushraider.com/en/documentation/api-doc/" target="_blank">exemple</a>
          are in PHP and I had to find the coresponding function in javascript. In order to get all the information I needed on a specific event I had to acces it with its
          id. So i add two commands:
          <ul>
            <li>
              One that get you the id of the i-th next event. So the id of the next event can be acces with:
              <br />
              <img src="../img/discord_bot_id.png" />
            </li>
            <li>
              One that get you all the information i wanted to display of a specific event:
              <br />
              <img src="../img/discord_bot_raid.png" />
            </li>
          </ul>
        </p>

        <h3>Async function</h3>

        <p>
          To merge the two command in one I needed to use async function. So when I type "!raid 0" it first send a fetch request to get the id of the next raid, I wait for
          this request to finish and then send an other request using this id to get the raid information.

          <pre><code>
try{
  const response = await fetch(url);
  const data = await response.json();
  return data;
} catch(err){
  console.log(err);
}
        </pre></code>

        <img src="../img/discord_bot_async.png" />
        </p>

        <h3>Embed version</h3>

        <p>
          Lastly to get a cleaner display I used the RichEmbed constructor of Discord.js features.

          <img src="../img/discord_bot_embed.png" />

        </p>

        <p>
          At the end this was an interesting litle project that teach me how to use async function and develop a node.js app.
        </p>

    </div>

</body>

</html>
